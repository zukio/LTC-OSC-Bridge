#!/bin/bash
set -euo pipefail

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$PROJECT_ROOT"

# --- OS パッケージのインストール -------------------------------------------------
if command -v apt-get >/dev/null 2>&1; then
    if [[ ${EUID:-$(id -u)} -ne 0 ]] && command -v sudo >/dev/null 2>&1; then
        SUDO="sudo"
    else
        SUDO=""
    fi

    export DEBIAN_FRONTEND=noninteractive
    $SUDO apt-get update
    $SUDO apt-get install -y --no-install-recommends \
        python3 python3-venv python3-pip python3-dev python3-tk \
        portaudio19-dev libltc11 libltc-dev python3-dbus python3-xlib
else
    echo "apt-get が見つかりません。必要なパッケージを手動でインストールしてください。" >&2
fi

# --- Python 仮想環境の作成 ---------------------------------------------------------
if [[ ! -d "venv" ]]; then
    python3 -m venv venv
fi
source venv/bin/activate

# --- Python 依存関係のインストール -------------------------------------------------
python -m pip install --upgrade pip setuptools wheel
python -m pip install -r requirements.txt
